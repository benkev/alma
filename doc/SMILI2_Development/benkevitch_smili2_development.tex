\documentclass[preprint]{aastex}

\begin{document}

\title{Development and Validation of the SMILI2 Input/Output for CASA FITS Files}

\author{L. V. Benkevitch}
\affil{MIT Haystack Observatory, Westford MA}

SMILI2 is a Python package for imaging multidimensional visibility data from radio interferometer arrays. SMILI2 is being developed in the framework of Atacama Large Millimeter/submillimeter Array (ALMA). CASA, the Common Astronomy Software Applications package, is the radio astronomy data processing software being developed and maintained by NRAO, National Radio Astronomical Observatory. CASA can be considered as a successor to the older and mature package AIPS. 

It is common to save, keep, and transfer brightness image data in the FITS format files. However, SMILI2 has its native format for keeping the image data different from the FITS and other standards. In order to import and export external images the SMILI2 Image class has a set of methods to load and save the internal image data in FITS format. Unfortunately, different astronomy software systems have different FITS formats and metadata, so SMILI2 has to have several methods to load/save the FITS files in the most common formats.

This document describes the development and testing of the \verb@load_fits_casa()@ and \verb@to_fits_casa()@ methods to load/save the image FITS files in the format generated by CASA and accepted by CASA. Also, described are the Python scripts created for the testing: 

\begin{enumerate}
  \item \verb@@
  \item \verb@alma_util.py@
  \item \verb@RoundSpottyDisk_Betelgeuse.py@
  \item \verb@load_save_Betelgeuse.py@
  \item three
  \item four
\end{enumerate}


\section{A Utility Module}

A simple module \verb@alma_util.py@ currently provides the only function, \verb@workdir.py@, returning a string with the ``work" directory path. It helps make scripts running universally on any of the machines used by the SMILI2 developers. The ``work" directory (supposedly containing the ALMA and \verb@smili2_dev@ directories) is different on different servers. On leonid2 and capelin (owned by Lynn Matthews) it is \verb@/data-smili/@. On isco it is \verb@/data-isco/data-smili/@. On my machine it is my home directory, \verb@/home/benkev/@, etc. 

In order to use it in CASA scripts, the user should copy \verb@alma_util.py@ to his or her CASA installation \verb@site-packages@ directory, which is like \\
\verb@casa-release-5.7.2-4.el7/lib/python2.7/site-packages/@.


\section{Creating a FITS Model Image of Betelgeuse}

The script \verb@RoundSpottyDisk_Betelgeuse.py@ creates a circular spotted disk at the Betelgeuse sky coordinates at  \verb@RA=05h55m10.0800s@, \verb@DEC=07d24m25.200s@ (equinox \verb@J2000@), the size equivalent to 80 $\mu$as, which is the size of Betelgeuse found by Lim \emph{et al.} at 46 GHz. The script must be run in CASA: \\
\verb@execfile('RoundSpottyDisk_Betelgeuse.py')@ \\
This command saves the model Betelgeuse image in the file \verb@RoundSpottyDisk_alma.fits@.


\section{Loading and Saving the FITS Image with SMILI2}

In SMILI2 the class \verb@imdata@ provides two methods, \verb@imdata.load_fits_casa()@ and \\ \verb@imdata.to_fits_casa()@ to load and save CASA-generated fits files. The script \\
\verb@load_save_Betelgeuse.py@ located in the top-level SMILI2 directory \verb@smili2_dev@ uses these methods. It loads the file \verb@RoundSpottyDisk_alma.fits@ converting it into the internal SMILI2 format and then converts it back into the FITS format saving it under the name \\
\verb@RoundSpottyDisk_smili.fits@. The script \verb@imdata.load_fits_casa()@ should be run outside of CASA, for example, it runs in IPython as \\
\verb@%run load_save_Betelgeuse.py @


\section{Testing the FITS Image Datacubes Identity}

In order to prove that SMILI2 saves FITS files in the true CASA format we first tested the identity of the datacubes in FITS files created by CASA, \verb@RoundSpottyDisk_alma.fits@, and created by SMILI2, \verb@RoundSpottyDisk_smili.fits@. The script \verb@diff_fits.py@ reads the data from both files into memory and compares them, printing if they are identical or not. It can be run as \\ 
\verb@%run diff_fits.py@ \\
After a few debugging iterations, SMILI2 makes the data in the saved FITS file totally identical to that of the input CASA-generated FITS file.


\section{Testing the CASA Measurement Sets' Visibility Data Identity}
\section{Testing the Calibration Tables Identity}



\section{Appendix}

The testing software is located at the github repository \\
\verb@https://github.com/benkev/alma@ \\
The user can create a local copy at a disk location using the command \\
\verb%$ git clone git@github.com:benkev/alma.git alma% \\

Currently, the software does not require compilation or installation.






\end{document}